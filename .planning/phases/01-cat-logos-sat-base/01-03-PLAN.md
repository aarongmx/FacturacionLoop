---
phase: 01-cat-logos-sat-base
plan: 03
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - app/Filament/Resources/RegimenFiscalResource.php
  - app/Filament/Resources/RegimenFiscalResource/Pages/ListRegimenFiscals.php
  - app/Filament/Resources/UsoCfdiResource.php
  - app/Filament/Resources/UsoCfdiResource/Pages/ListUsoCfdis.php
  - app/Filament/Resources/FormaPagoResource.php
  - app/Filament/Resources/FormaPagoResource/Pages/ListFormaPagos.php
  - app/Filament/Resources/MetodoPagoResource.php
  - app/Filament/Resources/MetodoPagoResource/Pages/ListMetodoPagos.php
  - app/Filament/Resources/TipoDeComprobanteResource.php
  - app/Filament/Resources/TipoDeComprobanteResource/Pages/ListTipoDeComprobantes.php
  - app/Filament/Resources/ImpuestoResource.php
  - app/Filament/Resources/ImpuestoResource/Pages/ListImpuestos.php
  - app/Filament/Resources/TipoFactorResource.php
  - app/Filament/Resources/TipoFactorResource/Pages/ListTipoFactors.php
  - app/Filament/Resources/ObjetoImpResource.php
  - app/Filament/Resources/ObjetoImpResource/Pages/ListObjetoImps.php
  - app/Filament/Resources/TipoRelacionResource.php
  - app/Filament/Resources/TipoRelacionResource/Pages/ListTipoRelacions.php
  - app/Filament/Resources/ClaveProdServResource.php
  - app/Filament/Resources/ClaveProdServResource/Pages/ListClaveProdServs.php
  - app/Filament/Resources/ClaveUnidadResource.php
  - app/Filament/Resources/ClaveUnidadResource/Pages/ListClaveUnidads.php
  - app/Filament/Resources/TasaOCuotaResource.php
  - app/Filament/Resources/TasaOCuotaResource/Pages/ListTasaOCuotas.php
autonomous: true
requirements:
  - CAT-01
  - CAT-02
  - CAT-03
  - CAT-04
  - CAT-05
  - CAT-06
  - CAT-07
  - CAT-08
  - CAT-09
  - CAT-10
  - CAT-11
  - CAT-12
must_haves:
  truths:
    - "A Filament user can navigate to Catalogos SAT navigation group and see all 12 catalogs listed"
    - "A Filament user can search and filter c_ClaveProdServ by clave or descripcion without browser freeze"
    - "A Filament user can search and filter c_ClaveUnidad by clave or nombre"
    - "All catalog resources are read-only — no create, edit, or delete actions"
  artifacts:
    - path: "app/Filament/Resources/RegimenFiscalResource.php"
      provides: "Filament read-only resource for regimenes fiscales"
      contains: "navigationGroup = 'Catálogos SAT'"
    - path: "app/Filament/Resources/ClaveProdServResource.php"
      provides: "Filament resource for large product/service catalog with deferred loading"
      contains: "deferLoading"
    - path: "app/Filament/Resources/ClaveUnidadResource.php"
      provides: "Filament resource for unit keys catalog"
      contains: "searchable"
  key_links:
    - from: "app/Filament/Resources/RegimenFiscalResource.php"
      to: "app/Models/RegimenFiscal.php"
      via: "$model property"
      pattern: "model.*RegimenFiscal"
    - from: "app/Filament/Resources/ClaveProdServResource.php"
      to: "app/Models/ClaveProdServ.php"
      via: "$model property"
      pattern: "model.*ClaveProdServ"
---

<objective>
Create Filament admin resources for all 12 SAT catalogs so users can browse, search, and filter catalog data.

Purpose: The success criteria for Phase 1 require that a Filament user can navigate to catalog admin sections and see seeded records, search c_ClaveProdServ (~53K rows), and search c_ClaveUnidad (~2K rows). These resources provide the browsing UI.
Output: 12 Filament resources (list-only, read-only) grouped under "Catalogos SAT" navigation group.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-cat-logos-sat-base/01-RESEARCH.md
@.planning/phases/01-cat-logos-sat-base/01-01-SUMMARY.md

<interfaces>
<!-- Filament resource pattern from RESEARCH.md: -->

```php
final class RegimenFiscalResource extends Resource
{
    protected static ?string $model = RegimenFiscal::class;
    protected static ?string $navigationIcon = 'heroicon-o-rectangle-stack';
    protected static ?string $navigationGroup = 'Catálogos SAT';
    protected static ?string $modelLabel = 'Régimen Fiscal';
    protected static ?string $pluralModelLabel = 'Regímenes Fiscales';

    public static function form(Form $form): Form
    {
        return $form->schema([]);
    }

    public static function table(Table $table): Table
    {
        return $table
            ->columns([
                TextColumn::make('clave')->searchable()->sortable()->label('Clave'),
                TextColumn::make('descripcion')->searchable()->label('Descripción'),
            ])
            ->defaultSort('clave')
            ->paginated([25, 50, 100]);
    }

    public static function getPages(): array
    {
        return [
            'index' => Pages\ListRegimenFiscals::route('/'),
        ];
    }
}
```

<!-- AdminPanelProvider uses auto-discovery: -->
```php
->discoverResources(in: app_path('Filament/Resources'), for: 'App\Filament\Resources')
```
No manual registration needed — resources are auto-discovered.
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Filament resources for 9 small SAT catalogs</name>
  <files>
    app/Filament/Resources/RegimenFiscalResource.php
    app/Filament/Resources/RegimenFiscalResource/Pages/ListRegimenFiscals.php
    app/Filament/Resources/UsoCfdiResource.php
    app/Filament/Resources/UsoCfdiResource/Pages/ListUsoCfdis.php
    app/Filament/Resources/FormaPagoResource.php
    app/Filament/Resources/FormaPagoResource/Pages/ListFormaPagos.php
    app/Filament/Resources/MetodoPagoResource.php
    app/Filament/Resources/MetodoPagoResource/Pages/ListMetodoPagos.php
    app/Filament/Resources/TipoDeComprobanteResource.php
    app/Filament/Resources/TipoDeComprobanteResource/Pages/ListTipoDeComprobantes.php
    app/Filament/Resources/ImpuestoResource.php
    app/Filament/Resources/ImpuestoResource/Pages/ListImpuestos.php
    app/Filament/Resources/TipoFactorResource.php
    app/Filament/Resources/TipoFactorResource/Pages/ListTipoFactors.php
    app/Filament/Resources/ObjetoImpResource.php
    app/Filament/Resources/ObjetoImpResource/Pages/ListObjetoImps.php
    app/Filament/Resources/TipoRelacionResource.php
    app/Filament/Resources/TipoRelacionResource/Pages/ListTipoRelacions.php
  </files>
  <action>
Use `php artisan make:filament-resource {ModelName} --no-interaction` to scaffold each resource, then customize. For each resource:

1. Set `protected static ?string $navigationGroup = 'Catálogos SAT';`
2. Set `protected static ?string $navigationIcon = 'heroicon-o-rectangle-stack';`
3. Set appropriate `$modelLabel` and `$pluralModelLabel` in Spanish
4. Configure `table()` with searchable/sortable columns appropriate to each catalog
5. Remove Create and Edit pages from `getPages()` — keep only list page (read-only resources)
6. Remove the `form()` contents — return empty schema `$form->schema([])`

**Per-resource table columns:**

1. **RegimenFiscalResource** — `$modelLabel = 'Régimen Fiscal'`, `$pluralModelLabel = 'Regímenes Fiscales'`:
   - TextColumn `clave` (searchable, sortable, label 'Clave')
   - TextColumn `descripcion` (searchable, label 'Descripción', wrap)
   - IconColumn `aplica_fisica` (boolean, label 'Persona Física')
   - IconColumn `aplica_moral` (boolean, label 'Persona Moral')

2. **UsoCfdiResource** — `$modelLabel = 'Uso CFDI'`, `$pluralModelLabel = 'Usos CFDI'`:
   - TextColumn `clave` (searchable, sortable)
   - TextColumn `descripcion` (searchable, wrap)
   - IconColumn `aplica_fisica` (boolean, label 'Persona Física')
   - IconColumn `aplica_moral` (boolean, label 'Persona Moral')

3. **FormaPagoResource** — `$modelLabel = 'Forma de Pago'`, `$pluralModelLabel = 'Formas de Pago'`:
   - TextColumn `clave` (searchable, sortable)
   - TextColumn `descripcion` (searchable, wrap)
   - IconColumn `bancarizado` (boolean, label 'Bancarizado')

4. **MetodoPagoResource** — `$modelLabel = 'Método de Pago'`, `$pluralModelLabel = 'Métodos de Pago'`:
   - TextColumn `clave` (searchable, sortable)
   - TextColumn `descripcion` (searchable)

5. **TipoDeComprobanteResource** — `$modelLabel = 'Tipo de Comprobante'`, `$pluralModelLabel = 'Tipos de Comprobante'`:
   - TextColumn `clave` (searchable, sortable)
   - TextColumn `descripcion` (searchable)

6. **ImpuestoResource** — `$modelLabel = 'Impuesto'`, `$pluralModelLabel = 'Impuestos'`:
   - TextColumn `clave` (searchable, sortable)
   - TextColumn `descripcion` (searchable)

7. **TipoFactorResource** — `$modelLabel = 'Tipo de Factor'`, `$pluralModelLabel = 'Tipos de Factor'`:
   - TextColumn `clave` (searchable, sortable)
   - TextColumn `descripcion` (searchable)

8. **ObjetoImpResource** — `$modelLabel = 'Objeto de Impuesto'`, `$pluralModelLabel = 'Objetos de Impuesto'`:
   - TextColumn `clave` (searchable, sortable)
   - TextColumn `descripcion` (searchable)

9. **TipoRelacionResource** — `$modelLabel = 'Tipo de Relación'`, `$pluralModelLabel = 'Tipos de Relación'`:
   - TextColumn `clave` (searchable, sortable)
   - TextColumn `descripcion` (searchable)

All resources: `->defaultSort('clave')`, `->paginated([25, 50, 100])`.

Run `vendor/bin/pint --dirty --format agent` after all files are created.
  </action>
  <verify>
    <automated>cd /home/aarongmx/Proyectos/FacturacionLoop && php artisan route:list --path=admin 2>&1 | head -30 && php artisan test --compact 2>&1 | tail -5</automated>
  </verify>
  <done>9 Filament resources created under Catalogos SAT navigation group. Each resource is list-only (no create/edit pages). All columns are searchable. All PHP files pass Pint.</done>
</task>

<task type="auto">
  <name>Task 2: Create Filament resources for 3 large/special SAT catalogs with performance optimization</name>
  <files>
    app/Filament/Resources/ClaveProdServResource.php
    app/Filament/Resources/ClaveProdServResource/Pages/ListClaveProdServs.php
    app/Filament/Resources/ClaveUnidadResource.php
    app/Filament/Resources/ClaveUnidadResource/Pages/ListClaveUnidads.php
    app/Filament/Resources/TasaOCuotaResource.php
    app/Filament/Resources/TasaOCuotaResource/Pages/ListTasaOCuotas.php
  </files>
  <action>
Create 3 Filament resources that need special handling for performance or unique schema.

**1. ClaveProdServResource** — `$modelLabel = 'Clave Producto/Servicio'`, `$pluralModelLabel = 'Claves de Producto/Servicio'`:

This is the critical large catalog (~53,000 rows). MUST use `->deferLoading()` on the table.

```php
public static function table(Table $table): Table
{
    return $table
        ->columns([
            TextColumn::make('clave')->searchable()->sortable()->label('Clave'),
            TextColumn::make('descripcion')->searchable()->label('Descripción')->wrap()->limit(100),
            TextColumn::make('incluye_iva')->label('Incluye IVA'),
            TextColumn::make('incluye_ieps')->label('Incluye IEPS'),
        ])
        ->defaultSort('clave')
        ->paginated([25, 50, 100])
        ->deferLoading();  // CRITICAL for 53K rows — prevents loading all records on page load
}
```

Do NOT add `'all'` to paginated options. Do NOT disable pagination.

**2. ClaveUnidadResource** — `$modelLabel = 'Clave de Unidad'`, `$pluralModelLabel = 'Claves de Unidad'`:

```php
public static function table(Table $table): Table
{
    return $table
        ->columns([
            TextColumn::make('clave')->searchable()->sortable()->label('Clave'),
            TextColumn::make('nombre')->searchable()->sortable()->label('Nombre'),
            TextColumn::make('descripcion')->label('Descripción')->wrap()->limit(100),
            TextColumn::make('simbolo')->label('Símbolo'),
        ])
        ->defaultSort('clave')
        ->paginated([25, 50, 100])
        ->deferLoading();
}
```

**3. TasaOCuotaResource** — `$modelLabel = 'Tasa o Cuota'`, `$pluralModelLabel = 'Tasas o Cuotas'`:

```php
public static function table(Table $table): Table
{
    return $table
        ->columns([
            TextColumn::make('impuesto')->searchable()->sortable()->label('Impuesto'),
            TextColumn::make('factor')->searchable()->sortable()->label('Factor'),
            TextColumn::make('valor_minimo')->label('Valor Mínimo'),
            TextColumn::make('valor_maximo')->label('Valor Máximo'),
            IconColumn::make('traslado')->boolean()->label('Traslado'),
            IconColumn::make('retencion')->boolean()->label('Retención'),
        ])
        ->defaultSort('impuesto')
        ->paginated([25, 50, 100]);
}
```

All 3 resources: same navigation group `'Catálogos SAT'`, same icon, list-only (no create/edit pages), empty form schema.

Run `vendor/bin/pint --dirty --format agent`.
  </action>
  <verify>
    <automated>cd /home/aarongmx/Proyectos/FacturacionLoop && php artisan test --compact 2>&1 | tail -5 && ls app/Filament/Resources/ | wc -l</automated>
  </verify>
  <done>3 Filament resources created for large/special catalogs. ClaveProdServResource and ClaveUnidadResource use deferLoading(). All resources are read-only. Total 12 resources exist under Catalogos SAT group. All PHP files pass Pint.</done>
</task>

</tasks>

<verification>
- All 12 Filament resource files exist in `app/Filament/Resources/`
- Each resource has a Pages directory with a List page only (no Create or Edit)
- `php artisan test --compact` passes (no regressions)
- `vendor/bin/pint --dirty --format agent` reports no changes
- All resources set `$navigationGroup = 'Catálogos SAT'`
</verification>

<success_criteria>
- 12 Filament resources auto-discovered by AdminPanelProvider
- All grouped under "Catalogos SAT" navigation section
- ClaveProdServResource uses deferLoading() for 53K row performance
- All resources are read-only (list page only, no create/edit)
- Columns display clave (searchable, sortable) and descripcion (searchable) at minimum
</success_criteria>

<output>
After completion, create `.planning/phases/01-cat-logos-sat-base/01-03-SUMMARY.md`
</output>
