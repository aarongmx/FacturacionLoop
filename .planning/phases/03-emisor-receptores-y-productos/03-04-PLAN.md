---
phase: 03-emisor-receptores-y-productos
plan: 04
type: execute
wave: 3
depends_on: [03-01, 03-02, 03-03]
files_modified:
  - tests/Feature/Models/EmisorTest.php
  - tests/Feature/Models/ReceptorTest.php
  - tests/Feature/Models/ProductoTest.php
  - tests/Feature/Rules/ValidaRfcTest.php
autonomous: true
requirements:
  - ENT-01
  - ENT-02
  - ENT-03
  - ENT-04
  - ENT-05
  - PROD-01
  - PROD-02
  - PROD-03
must_haves:
  truths:
    - "Emisor can be created via factory and has regimenesFiscales BelongsToMany that syncs correctly"
    - "Receptor can be created via factory, supports soft delete, and has regimenFiscal/usoCfdi BelongsTo relationships"
    - "Receptor factory states produce valid publicoEnGeneral, personaMoral, and extranjero records"
    - "Producto can be created via factory, supports soft delete, has impuestos HasMany, and casts precio_unitario correctly"
    - "ProductoImpuesto tax lines are created and retrieved via Producto's impuestos() relationship"
    - "ValidaRfc accepts valid 12-char moral, 13-char fisica, XAXX010101000, XEXX010101000 and rejects invalid formats"
  artifacts:
    - path: "tests/Feature/Models/EmisorTest.php"
      provides: "Pest tests for Emisor model: factory, relationships, singleton pattern"
      contains: "regimenesFiscales"
    - path: "tests/Feature/Models/ReceptorTest.php"
      provides: "Pest tests for Receptor model: factory, soft deletes, relationships, factory states"
      contains: "SoftDeletes"
    - path: "tests/Feature/Models/ProductoTest.php"
      provides: "Pest tests for Producto model: factory, soft deletes, relationships, tax lines, decimal cast"
      contains: "impuestos"
    - path: "tests/Feature/Rules/ValidaRfcTest.php"
      provides: "Pest tests for ValidaRfc rule: valid/invalid RFC formats, generics, edge cases"
      contains: "ValidaRfc"
  key_links:
    - from: "tests/Feature/Models/EmisorTest.php"
      to: "app/Models/Emisor.php"
      via: "Test subject"
      pattern: "Emisor::factory"
    - from: "tests/Feature/Models/ReceptorTest.php"
      to: "app/Models/Receptor.php"
      via: "Test subject"
      pattern: "Receptor::factory"
    - from: "tests/Feature/Models/ProductoTest.php"
      to: "app/Models/Producto.php"
      via: "Test subject"
      pattern: "Producto::factory"
    - from: "tests/Feature/Rules/ValidaRfcTest.php"
      to: "app/Rules/ValidaRfc.php"
      via: "Test subject"
      pattern: "ValidaRfc"
---

<objective>
Create comprehensive Pest feature tests for all Phase 3 models and the ValidaRfc rule.

Purpose: Every requirement in Phase 3 needs programmatic verification. These tests prove the data layer, relationships, validation, and factory states work correctly before Phase 4 consumes them.
Output: 4 test files covering Emisor, Receptor, Producto models and ValidaRfc rule — all following the established Pest test pattern from Phase 1 and 2 tests.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-emisor-receptores-y-productos/03-RESEARCH.md
@.planning/phases/03-emisor-receptores-y-productos/03-01-SUMMARY.md
@.planning/phases/03-emisor-receptores-y-productos/03-02-SUMMARY.md
@.planning/phases/03-emisor-receptores-y-productos/03-03-SUMMARY.md

<interfaces>
<!-- From 03-01: Models created -->

```php
// Emisor: table='emisores', fillable=[rfc, razon_social, domicilio_fiscal_cp, logo_path]
//   regimenesFiscales(): BelongsToMany -> emisor_regimen_fiscal pivot

// Receptor: table='receptores', SoftDeletes, fillable=[rfc, nombre_fiscal, domicilio_fiscal_cp, regimen_fiscal_clave, uso_cfdi_clave]
//   regimenFiscal(): BelongsTo -> regimenes_fiscales.clave
//   usoCfdi(): BelongsTo -> usos_cfdi.clave

// Producto: table='productos', SoftDeletes, fillable=[clave_prod_serv, clave_unidad, descripcion, precio_unitario, objeto_imp_clave]
//   casts: precio_unitario => 'decimal:6'
//   impuestos(): HasMany -> producto_impuestos

// ProductoImpuesto: table='producto_impuestos', fillable=[producto_id, impuesto_clave, tipo_factor, tasa_o_cuota_id, es_retencion]
//   casts: es_retencion => 'boolean'
```

<!-- From 03-01: ValidaRfc rule -->

```php
final class ValidaRfc implements ValidationRule
{
    // Accepts: 12-char moral (AAA######XXX), 13-char fisica (AAAA######XXX), XAXX010101000, XEXX010101000
    // Rejects: wrong length, wrong format, missing parts
}
```

<!-- Established test pattern from CsdTest.php: -->

```php
declare(strict_types=1);

use App\Models\Csd;

it('can be created via factory', function (): void {
    $csd = Csd::factory()->create();
    expect($csd)->toBeInstanceOf(Csd::class)
        ->and($csd->id)->toBeInt()
        ->and($csd->id)->toBeGreaterThan(0);
});

it('supports soft delete', function (): void {
    $csd = Csd::factory()->create();
    $id = $csd->id;
    $csd->delete();
    expect(Csd::find($id))->toBeNull()
        ->and(Csd::withTrashed()->find($id))->not->toBeNull();
});
```

<!-- Factory states available: -->

```php
// EmisorFactory: definition()
// ReceptorFactory: definition(), personaMoral(), publicoEnGeneral(), extranjero()
// ProductoFactory: definition() — uses hardcoded SAT claves
// ProductoImpuestoFactory: definition(), iva16(), isrRetencion()
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EmisorTest and ReceptorTest</name>
  <files>
    tests/Feature/Models/EmisorTest.php
    tests/Feature/Models/ReceptorTest.php
  </files>
  <action>
**Step 1: Create test files using Artisan.**

```bash
./vendor/bin/sail php artisan make:test --pest Models/EmisorTest --no-interaction
./vendor/bin/sail php artisan make:test --pest Models/ReceptorTest --no-interaction
```

**Step 2: Write EmisorTest.**

```php
declare(strict_types=1);

use App\Models\Emisor;
use App\Models\RegimenFiscal;

it('can be created via factory', function (): void {
    $emisor = Emisor::factory()->create();
    expect($emisor)->toBeInstanceOf(Emisor::class)
        ->and($emisor->id)->toBeInt()
        ->and($emisor->id)->toBeGreaterThan(0);
});

it('has fillable attributes', function (): void {
    $emisor = Emisor::factory()->create([
        'rfc' => 'AAA010101AAA',
        'razon_social' => 'Mi Empresa SA de CV',
        'domicilio_fiscal_cp' => '06600',
    ]);
    expect($emisor->rfc)->toBe('AAA010101AAA')
        ->and($emisor->razon_social)->toBe('Mi Empresa SA de CV')
        ->and($emisor->domicilio_fiscal_cp)->toBe('06600');
});

it('allows nullable logo_path', function (): void {
    $emisor = Emisor::factory()->create(['logo_path' => null]);
    expect($emisor->logo_path)->toBeNull();

    $emisorWithLogo = Emisor::factory()->create(['logo_path' => 'emisor/logo.png']);
    expect($emisorWithLogo->logo_path)->toBe('emisor/logo.png');
});

it('has regimenesFiscales BelongsToMany relationship', function (): void {
    $regimen = RegimenFiscal::factory()->create();
    $emisor = Emisor::factory()->create();

    $emisor->regimenesFiscales()->attach($regimen->clave);

    $loaded = $emisor->regimenesFiscales()->get();
    expect($loaded)->toHaveCount(1)
        ->and($loaded->first()->clave)->toBe($regimen->clave);
});

it('can sync multiple regimenes fiscales', function (): void {
    $regimen1 = RegimenFiscal::factory()->create();
    $regimen2 = RegimenFiscal::factory()->create();
    $emisor = Emisor::factory()->create();

    $emisor->regimenesFiscales()->sync([$regimen1->clave, $regimen2->clave]);

    expect($emisor->regimenesFiscales()->count())->toBe(2);

    // Sync with only one should remove the other
    $emisor->regimenesFiscales()->sync([$regimen1->clave]);
    expect($emisor->fresh()->regimenesFiscales()->count())->toBe(1);
});

it('uses emisores table', function (): void {
    $emisor = new Emisor;
    expect($emisor->getTable())->toBe('emisores');
});
```

**Step 3: Write ReceptorTest.**

```php
declare(strict_types=1);

use App\Models\Receptor;
use App\Models\RegimenFiscal;
use App\Models\UsoCfdi;

it('can be created via factory', function (): void {
    $receptor = Receptor::factory()->create();
    expect($receptor)->toBeInstanceOf(Receptor::class)
        ->and($receptor->id)->toBeInt()
        ->and($receptor->id)->toBeGreaterThan(0);
});

it('has fillable attributes', function (): void {
    $receptor = Receptor::factory()->create([
        'rfc' => 'ABCD010101AB1',
        'nombre_fiscal' => 'Cliente Test',
        'domicilio_fiscal_cp' => '03100',
    ]);
    expect($receptor->rfc)->toBe('ABCD010101AB1')
        ->and($receptor->nombre_fiscal)->toBe('Cliente Test')
        ->and($receptor->domicilio_fiscal_cp)->toBe('03100');
});

it('supports soft delete', function (): void {
    $receptor = Receptor::factory()->create();
    $id = $receptor->id;

    $receptor->delete();

    expect(Receptor::find($id))->toBeNull()
        ->and(Receptor::withTrashed()->find($id))->not->toBeNull();
});

it('can be restored after soft delete', function (): void {
    $receptor = Receptor::factory()->create();
    $id = $receptor->id;

    $receptor->delete();
    expect(Receptor::find($id))->toBeNull();

    Receptor::withTrashed()->find($id)->restore();
    expect(Receptor::find($id))->not->toBeNull();
});

it('has regimenFiscal BelongsTo relationship', function (): void {
    $regimen = RegimenFiscal::factory()->create();
    $receptor = Receptor::factory()->create([
        'regimen_fiscal_clave' => $regimen->clave,
    ]);

    expect($receptor->regimenFiscal)->toBeInstanceOf(RegimenFiscal::class)
        ->and($receptor->regimenFiscal->clave)->toBe($regimen->clave);
});

it('has usoCfdi BelongsTo relationship', function (): void {
    $usoCfdi = UsoCfdi::factory()->create();
    $receptor = Receptor::factory()->create([
        'uso_cfdi_clave' => $usoCfdi->clave,
    ]);

    expect($receptor->usoCfdi)->toBeInstanceOf(UsoCfdi::class)
        ->and($receptor->usoCfdi->clave)->toBe($usoCfdi->clave);
});

it('allows nullable FK fields', function (): void {
    $receptor = Receptor::factory()->create([
        'regimen_fiscal_clave' => null,
        'uso_cfdi_clave' => null,
    ]);
    expect($receptor->regimen_fiscal_clave)->toBeNull()
        ->and($receptor->uso_cfdi_clave)->toBeNull();
});

it('allows duplicate RFCs', function (): void {
    $rfc = 'ABCD010101AB1';
    Receptor::factory()->create(['rfc' => $rfc]);
    $second = Receptor::factory()->create(['rfc' => $rfc]);

    expect($second->id)->toBeGreaterThan(0);
    expect(Receptor::where('rfc', $rfc)->count())->toBe(2);
});

it('creates público en general via factory state', function (): void {
    $receptor = Receptor::factory()->publicoEnGeneral()->create();
    expect($receptor->rfc)->toBe('XAXX010101000')
        ->and($receptor->nombre_fiscal)->toBe('PUBLICO EN GENERAL')
        ->and($receptor->regimen_fiscal_clave)->toBe('616')
        ->and($receptor->uso_cfdi_clave)->toBe('S01');
});

it('creates persona moral via factory state', function (): void {
    $receptor = Receptor::factory()->personaMoral()->create();
    expect(strlen($receptor->rfc))->toBe(12);
});

it('creates extranjero via factory state', function (): void {
    $receptor = Receptor::factory()->extranjero()->create();
    expect($receptor->rfc)->toBe('XEXX010101000');
});

it('uses receptores table', function (): void {
    $receptor = new Receptor;
    expect($receptor->getTable())->toBe('receptores');
});
```

Run `vendor/bin/pint --dirty --format agent` after creating both files.

Then run tests:
```bash
./vendor/bin/sail php artisan test --compact --filter=EmisorTest
./vendor/bin/sail php artisan test --compact --filter=ReceptorTest
```
  </action>
  <verify>
    <automated>cd /home/aarongmx/Proyectos/FacturacionLoop && ./vendor/bin/sail php artisan test --compact --filter=EmisorTest && ./vendor/bin/sail php artisan test --compact --filter=ReceptorTest</automated>
  </verify>
  <done>EmisorTest covers factory creation, fillable attributes, logo_path nullable, regimenesFiscales BelongsToMany with attach/sync, and table name. ReceptorTest covers factory creation, fillable attributes, soft delete/restore, BelongsTo relationships, nullable FKs, duplicate RFCs, factory states (publicoEnGeneral, personaMoral, extranjero), and table name. All tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Create ProductoTest and ValidaRfcTest</name>
  <files>
    tests/Feature/Models/ProductoTest.php
    tests/Feature/Rules/ValidaRfcTest.php
  </files>
  <action>
**Step 1: Create test files using Artisan.**

```bash
./vendor/bin/sail php artisan make:test --pest Models/ProductoTest --no-interaction
./vendor/bin/sail php artisan make:test --pest Rules/ValidaRfcTest --no-interaction
```

Create `tests/Feature/Rules/` directory if it does not exist.

**Step 2: Write ProductoTest.**

The ProductoFactory uses hardcoded SAT claves that require seeded catalog records. Tests must create the required SAT catalog records first (via their factories) before creating Producto instances.

```php
declare(strict_types=1);

use App\Models\ClaveProdServ;
use App\Models\ClaveUnidad;
use App\Models\Impuesto;
use App\Models\ObjetoImp;
use App\Models\Producto;
use App\Models\ProductoImpuesto;
use App\Models\TasaOCuota;

beforeEach(function (): void {
    // Seed the SAT catalog records required by ProductoFactory defaults
    ClaveProdServ::factory()->create(['clave' => '01010101', 'descripcion' => 'No existe en el catálogo']);
    ClaveUnidad::factory()->create(['clave' => 'E48', 'nombre' => 'Unidad de servicio']);
    ObjetoImp::factory()->create(['clave' => '02', 'descripcion' => 'Sí objeto de impuesto']);
    Impuesto::factory()->create(['clave' => '002', 'descripcion' => 'IVA']);
    Impuesto::factory()->create(['clave' => '001', 'descripcion' => 'ISR']);
});

it('can be created via factory', function (): void {
    $producto = Producto::factory()->create();
    expect($producto)->toBeInstanceOf(Producto::class)
        ->and($producto->id)->toBeInt()
        ->and($producto->id)->toBeGreaterThan(0);
});

it('has fillable attributes', function (): void {
    $producto = Producto::factory()->create([
        'descripcion' => 'Servicio de consultoría',
        'precio_unitario' => 1500.500000,
    ]);
    expect($producto->descripcion)->toBe('Servicio de consultoría')
        ->and($producto->precio_unitario)->toBe('1500.500000');
});

it('casts precio_unitario to decimal with 6 places', function (): void {
    $producto = Producto::factory()->create([
        'precio_unitario' => 100.123456,
    ]);
    expect($producto->precio_unitario)->toBe('100.123456');
});

it('supports soft delete', function (): void {
    $producto = Producto::factory()->create();
    $id = $producto->id;

    $producto->delete();

    expect(Producto::find($id))->toBeNull()
        ->and(Producto::withTrashed()->find($id))->not->toBeNull();
});

it('can be restored after soft delete', function (): void {
    $producto = Producto::factory()->create();
    $id = $producto->id;

    $producto->delete();
    Producto::withTrashed()->find($id)->restore();

    expect(Producto::find($id))->not->toBeNull();
});

it('has claveProdServ BelongsTo relationship', function (): void {
    $producto = Producto::factory()->create();
    expect($producto->claveProdServ)->toBeInstanceOf(ClaveProdServ::class)
        ->and($producto->claveProdServ->clave)->toBe('01010101');
});

it('has claveUnidad BelongsTo relationship', function (): void {
    $producto = Producto::factory()->create();
    expect($producto->claveUnidad)->toBeInstanceOf(ClaveUnidad::class)
        ->and($producto->claveUnidad->clave)->toBe('E48');
});

it('has objetoImp BelongsTo relationship', function (): void {
    $producto = Producto::factory()->create();
    expect($producto->objetoImp)->toBeInstanceOf(ObjetoImp::class)
        ->and($producto->objetoImp->clave)->toBe('02');
});

it('has impuestos HasMany relationship', function (): void {
    $tasa = TasaOCuota::factory()->create([
        'impuesto' => '002',
        'factor' => 'Tasa',
        'valor_maximo' => '0.160000',
        'traslado' => true,
        'retencion' => false,
    ]);

    $producto = Producto::factory()->create();

    ProductoImpuesto::factory()->create([
        'producto_id' => $producto->id,
        'impuesto_clave' => '002',
        'tipo_factor' => 'Tasa',
        'tasa_o_cuota_id' => $tasa->id,
        'es_retencion' => false,
    ]);

    expect($producto->impuestos)->toHaveCount(1)
        ->and($producto->impuestos->first())->toBeInstanceOf(ProductoImpuesto::class)
        ->and($producto->impuestos->first()->impuesto_clave)->toBe('002');
});

it('cascades delete to impuestos when force deleted', function (): void {
    $tasa = TasaOCuota::factory()->create([
        'impuesto' => '002',
        'factor' => 'Tasa',
    ]);

    $producto = Producto::factory()->create();

    ProductoImpuesto::factory()->create([
        'producto_id' => $producto->id,
        'tasa_o_cuota_id' => $tasa->id,
    ]);

    expect(ProductoImpuesto::where('producto_id', $producto->id)->count())->toBe(1);

    $producto->forceDelete();

    expect(ProductoImpuesto::where('producto_id', $producto->id)->count())->toBe(0);
});

it('can have multiple tax lines', function (): void {
    $tasaIva = TasaOCuota::factory()->create([
        'impuesto' => '002',
        'factor' => 'Tasa',
        'valor_maximo' => '0.160000',
    ]);
    $tasaIsr = TasaOCuota::factory()->create([
        'impuesto' => '001',
        'factor' => 'Tasa',
        'valor_maximo' => '0.100000',
    ]);

    $producto = Producto::factory()->create();

    ProductoImpuesto::factory()->create([
        'producto_id' => $producto->id,
        'impuesto_clave' => '002',
        'tasa_o_cuota_id' => $tasaIva->id,
        'es_retencion' => false,
    ]);
    ProductoImpuesto::factory()->create([
        'producto_id' => $producto->id,
        'impuesto_clave' => '001',
        'tasa_o_cuota_id' => $tasaIsr->id,
        'es_retencion' => true,
    ]);

    expect($producto->fresh()->impuestos)->toHaveCount(2);
});

it('uses productos table', function (): void {
    $producto = new Producto;
    expect($producto->getTable())->toBe('productos');
});
```

**Step 3: Write ValidaRfcTest.**

```php
declare(strict_types=1);

use App\Rules\ValidaRfc;
use Illuminate\Support\Facades\Validator;

it('accepts valid persona física RFC (13 chars)', function (string $rfc): void {
    $validator = Validator::make(
        ['rfc' => $rfc],
        ['rfc' => [new ValidaRfc]],
    );
    expect($validator->passes())->toBeTrue();
})->with([
    'standard' => ['ABCD010101AB1'],
    'with numbers in homoclave' => ['XYZW890101123'],
    'with Ñ' => ['ÑABC010101AB1'],
    'with &' => ['&ABC010101AB1'],
]);

it('accepts valid persona moral RFC (12 chars)', function (string $rfc): void {
    $validator = Validator::make(
        ['rfc' => $rfc],
        ['rfc' => [new ValidaRfc]],
    );
    expect($validator->passes())->toBeTrue();
})->with([
    'standard' => ['AAA010101AA1'],
    'with numbers' => ['AB1010101123'],
    'with Ñ' => ['ÑAB010101AB1'],
]);

it('accepts generic RFC XAXX010101000 (público en general)', function (): void {
    $validator = Validator::make(
        ['rfc' => 'XAXX010101000'],
        ['rfc' => [new ValidaRfc]],
    );
    expect($validator->passes())->toBeTrue();
});

it('accepts generic RFC XEXX010101000 (extranjero)', function (): void {
    $validator = Validator::make(
        ['rfc' => 'XEXX010101000'],
        ['rfc' => [new ValidaRfc]],
    );
    expect($validator->passes())->toBeTrue();
});

it('accepts lowercase input by normalizing to uppercase', function (): void {
    $validator = Validator::make(
        ['rfc' => 'abcd010101ab1'],
        ['rfc' => [new ValidaRfc]],
    );
    expect($validator->passes())->toBeTrue();
});

it('accepts generic RFCs in lowercase', function (): void {
    $validator = Validator::make(
        ['rfc' => 'xaxx010101000'],
        ['rfc' => [new ValidaRfc]],
    );
    expect($validator->passes())->toBeTrue();
});

it('trims whitespace before validation', function (): void {
    $validator = Validator::make(
        ['rfc' => '  ABCD010101AB1  '],
        ['rfc' => [new ValidaRfc]],
    );
    expect($validator->passes())->toBeTrue();
});

it('rejects invalid RFC formats', function (string $rfc): void {
    $validator = Validator::make(
        ['rfc' => $rfc],
        ['rfc' => [new ValidaRfc]],
    );
    expect($validator->fails())->toBeTrue();
})->with([
    'too short' => ['ABCD0101'],
    'too long' => ['ABCDE010101AB12'],
    'only letters' => ['ABCDEFGHIJKLM'],
    'only numbers' => ['1234567890123'],
    'empty string' => [''],
    'special chars' => ['ABC@010101AB1'],
    'wrong date position' => ['ABCD01AB01011'],
]);

it('returns Spanish error message on failure', function (): void {
    $validator = Validator::make(
        ['rfc' => 'INVALID'],
        ['rfc' => [new ValidaRfc]],
    );
    expect($validator->errors()->first('rfc'))
        ->toContain('formato válido');
});
```

Run `vendor/bin/pint --dirty --format agent` after creating both files.

Then run tests:
```bash
./vendor/bin/sail php artisan test --compact --filter=ProductoTest
./vendor/bin/sail php artisan test --compact --filter=ValidaRfcTest
```

Finally, run the full suite to confirm no regressions:
```bash
./vendor/bin/sail php artisan test --compact
```
  </action>
  <verify>
    <automated>cd /home/aarongmx/Proyectos/FacturacionLoop && ./vendor/bin/sail php artisan test --compact --filter=ProductoTest && ./vendor/bin/sail php artisan test --compact --filter=ValidaRfcTest</automated>
  </verify>
  <done>ProductoTest covers factory creation, fillable attributes, decimal cast, soft delete/restore, all 4 BelongsTo relationships, HasMany impuestos, cascade delete, multiple tax lines, and table name. ValidaRfcTest covers valid persona física/moral, generic RFCs, lowercase normalization, whitespace trimming, invalid formats, and Spanish error message. All tests pass. Full test suite has no regressions.</done>
</task>

</tasks>

<verification>
- `./vendor/bin/sail php artisan test --compact --filter=EmisorTest` passes all assertions
- `./vendor/bin/sail php artisan test --compact --filter=ReceptorTest` passes all assertions
- `./vendor/bin/sail php artisan test --compact --filter=ProductoTest` passes all assertions
- `./vendor/bin/sail php artisan test --compact --filter=ValidaRfcTest` passes all assertions
- `./vendor/bin/sail php artisan test --compact` full suite passes with no regressions
- `vendor/bin/pint --dirty --format agent` reports no changes needed
</verification>

<success_criteria>
- EmisorTest: factory, fillable, logo nullable, regimenesFiscales attach/sync/count
- ReceptorTest: factory, fillable, soft delete/restore, relationships, nullable FKs, duplicate RFCs, 3 factory states, table name
- ProductoTest: factory, fillable, decimal cast, soft delete/restore, 4 relationships, HasMany tax lines, cascade delete, multiple taxes, table name
- ValidaRfcTest: valid fisica/moral, generic RFCs, lowercase, whitespace, invalid formats, Spanish error message
- Full test suite green
</success_criteria>

<output>
After completion, create `.planning/phases/03-emisor-receptores-y-productos/03-04-SUMMARY.md`
</output>
